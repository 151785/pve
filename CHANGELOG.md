# 更新日志

2023.10.03

- 修复开设带IPV6地址的虚拟机时，网关顺序错配的问题
- 更新开设出的虚拟机的nameserver和searchdomain设置，避免某些机器在解析域名时出错

2023.09.16

- 修复DNS修补过程中可能存在的判断漏洞
- 修复可能存在的ndp的sysctl设置问题
- 修复可能存在的网关的路由缓存问题，增加自动修复的守护进程

2023.09.15

- 迁移了KVM镜像中Centos8-Stream的所在地址

2023.09.07

- 修复默认的物理接口如果带altname时自动检测部分别名是否可附加，如果不可附加自动删除

2023.09.01

- 前置的环境检测增加是否是debian系统的检测，优化部分检测逻辑
- 主体安装的脚本前移二次环境检测，避免已修改了部分内容还去检测是否能安装，此时再判断已经迟了
- 优化IPV4地址检测，增加对 RFC 6598 地址的判断
- 前置的环境检测优化内存的检测，如果Swap不为0则包含Swap

2023.08.29

- 判断IPV6是否未dhcp类型，如果是则检测是否已分配IPV6地址，如果未分配则删除对应配置避免冲突

2023.08.27

- 将删除物理网关的操作移动到创建vmbr0之前，而不是原来的创建vmbr1之前

2023.08.26

- 修复开设NAT网关时，vmbr0如果不存在就去补全时的漏洞，尝试支持第一第二步安装PVE不使用本仓库脚本的PVE创建NAT网关
- 给IPV6的识别增加ping检测，如果ping不通当作IPV6不通，避免有的商家设置的IPV6本身就有问题根本用不了还配置，导致安装出问题

2023.08.23

- ndppd增加ARM架构的支持
- 修复了非独立IPV6的CT重启失败的问题，独立IPV6的CT可能还是会重启失败无法启动(目前测试ARM会重启出问题，X86的全部无问题)
- 选择开设带独立IPV6地址的服务前增加ndppd的检测，如果其状态异常则自动退出脚本

2023.08.22

- 使用ndppd进行独立IPV6映射解决MAC校验的问题，实测成功

2023.08.20

- iptables的映射存在重复的问题，已尝试修复
- 尝试在写入NAT网关的同时删除无用的原有网关配置，避免可能存在的问题

2023.08.15

- 尝试增加Docker安装PVE的方法以适配宿主机不是Debian的情况，实测支持Ubuntu了，其他支持Docker的宿主机系统应该也没问题

2023.08.11

- 修复部分上次更新导致的新BUG，测试无误了

2023.08.09

- 判断是否有IPV6网络，如果没有则宿主机就不添加对应的V6的DNS
- 判断是否有IPV6网络，如果没有则开设的虚拟机和容器就不添加对应的V6的DNS
- 修复带IPV6环境的容器设置ssh时，需要重启容器才能保证容器内网络联通的问题，自动判断是否需要自重启容器

2023.08.04

- 开设独立IPV4地址的虚拟机时，尝试增加自动附加IPV6地址的功能
- 增加一键开设纯IPV6虚拟机、纯IPV6容器的脚本
- 修复可能的dns-nameservers存在多行导致网络异常的问题
- 特殊处理没有ifupdown的宿主机

2023.08.03

- 尝试增加了IPV6的支持，暂时只是支持了IPV6网关的设置，暂时未适配一键开设，明日适配
- 简化IPV4和IPV6地址的查询，避免重复查询
- 修复可能的grub更新错误
- 网络配置文件备份修改顺序，避免重复备份
- 增加已修改过的文件的备份
- KVM虚拟机增加centos8-stream镜像源

2023.08.02

- 更新KVM虚拟机镜像源，支持更多系统
- 修复部分虚拟机开设时自定义硬盘大小失败的问题，增加设置间隔，避免硬盘IO爆炸

2023.07.31

- 修复部分机器重启机器后失联的情况(Hetzner、Azure)
- 增加自动时间校准功能
- 加速系统熵计算
- 修复创建虚拟机和容器的一键脚本分别适配ARM和X86_64的情况
- 重构物理接口检测函数，保证检测到的接口顺序与```ip addr show```一致
- 优化ssh.sh文件，如果开设debian的LXC容器时，遇到中国宿主机，对应自动替换apt源

2023.07.30

- 适配了ARM架构且已在hz的ARM机器上测试(Debian11及其更旧的系统)无问题，感谢[Proxmox-Arm64](https://github.com/jiangcuo/Proxmox-Arm64)提供的第三方补丁，本项目目前支持X86_64架构和ARM架构了
- 修改部分附加文件的存储位置至于```/usr/local/bin/```目录下
- CN的IP检测增加一个检测源，对CN的特殊处理增加对APT源的特殊处理
- 有些奇葩机器的apt源老有问题，增加自动修复的函数

2023.07.28

- 部分原生的厂商给的apt源有问题，不是官方源，比如Azure需要进行特殊处理，特转换archive为官方源以支持pve的安装，已修复该问题
- 整合网络修改部分的代码到同一个函数中，方便后续维护

2023.07.24

- 增强ssh.sh脚本开设ssh服务的能力，避免默认配置了cloudinit导致的问题

2023.07.06

- 增加公网私网IPV4地址的检测

2023.07.02

- 修复部分机器的网络配置重复行的部分空格数量不一致导致未识别出重复的问题
- 修复部分网络配置的子目录有写但不使用的情况，这种情况就不需要合并配置文件了，修复了之前强制合并的问题
- 修复适配部分机器默认防火墙是开启且屏蔽了部分端口的情况

2023.06.30

- 修复部分机器的网络配置是热加载，写在/run/network/interfaces.d/文件夹下的问题
- 修复安装proxmox-ve时grub-pc配置可能冲突的问题

2023.06.29

- 规整输出，所有输出修改为中英双语
- 修改部分脚本提示避免脚本被小白重复执行

2023.06.26

- 修复ipv6网络是SLAAC动态分配时vmbr0的设置导致宿主机没有V6网络的问题

2023.06.25

- 特化修复在Hetzner上安装需要DD系统再安装的问题，现在安装原生debian系统也支持了
- 修复部分机器使用浮动IP，没有/etc/network/interfaces文件的问题，自动生成对应文件
- 修复部分机器启动后，DNS检测失败的问题，确保在网关添加后必自动检测一次保证DNS无问题

2023.06.24

- 修复部分机器是IPV6子网前缀识别失效的问题
- 更新Debian12安装的PVE版本为stable
- 修复部分机器ifconfig命令不存在的问题
- 适配部分机器ipv6网络是SLAAC动态分配的情况
- 适配pve8.0的非订阅用户弹窗进行删除

2023.06.23

- 网关配置修改使用新结构，以便于适配大多数机器
- 调整安装的流程，升级软件包后需要重启一次系统，详见脚本的运行提示
- 解决了ifupdown2的安装问题，支持在更多商家的服务器上安装

2023.06.22

- PVE安装修复部分机器网络设置不立即重新加载的问题，增加网络设置备份
- 部分机器的IPV6物理接口使用auto类型，无法安装PVE，修改为static类型并重写配置
- 由于上面这条修复，已支持在Linode平台安装PVE了
- 修复低版本PVE还安装ifupdown2的问题，7.x以下版本使用ifupdown也足够了
- 由于上面这条修复，Hetzner的Debian10系统可以安装PVE了，但只可安装主体，不能自动设置网关

2023.06.21

- 增加手动指定IPV4地址的脚本
- PVE安装修复部分系统原生网络设置有问题的情况
- 修复NAT网关自动设置时部分机器的物理接口存在别名的情况，已自动识别替换别名

2023.06.14

- 修改ssh.sh文件以适配不同的系统启用SSH端口和服务
- 修改create_ct.sh文件及相关文件，增加适配支持开设centos系的系统的CT容器

2023.06.13

- 修改部分提示，避免错误的操作流程
- 增加对apparmor的依赖修复，避免安装apparmor在部分模板上卡死未成功安装
- 适配Debian12系统
- 重新整合组件安装部分的代码，优化代码结构
- 修改网关写入的文件，判断物理接口是否允许桥接，无配置的设置为允许

2023.06.06

- 修复检测过程中遇到系统盘以TB为单位的识别问题，适配系统盘以TB或GB单位计算
- 修复安装过程中部分奇葩模板可能出现的依赖问题，使用--fix-missing命令修复依赖

2023.06.05

- 创建IPV4的NAT网关时检测IPV4的方法改为使用ip addr show检测，不再使用ip route，这样可以带上IP区间不写死
- 自动检测IPV6子网是否存在，如果存在则绑定vmbr0，不存在则只绑定IPV4
- 更改部分说明的描述

2023.06.04

- 增加一键开设独立IPV4虚拟机的脚本，支持一键生成独立IPV4的KVM虚拟化的虚拟机
- 修改创建KVM虚拟机过程中预下载镜像前CDN检测的逻辑问题，如果已存在镜像则不再检测CDN有效性，因为无需通过CDN下载镜像文件
- 更新中文文档部分说明

2023.06.03

- 更新支持自动修复apt源缺失公钥的问题，不再需要手动修复
- 暂时移除静态动态地址转换，默认的是DHCP或静态的IP不再进行识别和转换，后续替换为别的方式解决
- NAT网络构建前检测lshw包是否存在是否需要下载，保证物理设备的识别能成功(部分奇葩的系统模板不自带该工具包)
- 更新中文文档部分说明

2023.05.30

- 更新支持批量开设的虚拟机或容器自定义系统，默认留空为debian11系统
- 更新修复使用批量开设前检测挂载盘系统盘的问题，暂时移除检测，后续修复检测
- 更新中文文档部分说明

2023.05.29 

- 增加自动写入NOTE的功能，开出的容器和虚拟机将自带对应的配置信息，不用再在命令行中使用cat查看了(但原有的配置信息文件还将存在，否则无法使用批量命令批量创建)

2023.05.20

- 增加支持开设的虚拟机和容器可自定义开设在挂载盘还是系统盘，默认留空使用系统盘local

2023.04.24 

- 更新支持国内腾讯云阿里云的Debian系安装PVE和开设LXC容器，由于国内机器非独服基本不开嵌套虚拟化支持，所以只能开LXC
- 更新支持创建vmbr0，母鸡允许addr和gateway为内网IP或外网IP，已自动识别替换

2023.04.23

- 支持一键生成LXC或KVM虚拟化的NAT服务器
- 支持批量开设，多次运行批量开设LXC或KVM虚拟化的NAT服务器，重复运行继承配置
- 开出的容器和虚拟机都自带IPV4内外网端口转发

2023.04.11 

- 更新支持一键生成单个KVM虚拟化的NAT服务器(自带内外网映射)
- 更新PVE自修改qcow2文件，已预开启安装cloudinit，开启SSH登陆，预设值SSH监听V4和V6的22端口，开启允许密码验证登陆，开启允许ROOT登陆

2023.04.04

- 开发了基于PVE的 [ConvoyPanel](https://github.com/ConvoyPanel/panel) 一键安装脚本
- PVE一键安装是ConvoyPanel一键安装的前提，创建NAT网关不是
- 修复PVE在VPS上一键安装可能遇到的各种BUG
